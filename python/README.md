## Shell  

未做测试，因为NAT 是基础，如果P2P 不通的话，一切都没有意义了

- [ ] 通过`shell` 的`runas` 参数看能否以管理员权限运行。  
- [ ] 利用`os.popen` 模块



------

## 远控  
  
- 内网穿透  
  - [x] 公网IP  
  - [ ] 管理员权限   
  - [x] 端口转发(https://gist.github.com/WangYihang/e7d36b744557e4673d2157499f6c6b5e)  
  - [x] NAT 挖洞(3389 TCP): 普通家用路由器都支持NAT，有效时间`5min`(运营商)，建议`30s`（运营商有限制：出入栈限制）   
  - [x] 端口复用(https://www.cnblogs.com/zhumengke/articles/11300519.html)。两个socket 不能同时存在，先利用客户端获取自己的远程端口，再绑定服务端（运营商有限制）
  - [x] 长连接维持。利用TCP 心跳包；新建sockect 连接自己的远程端口

- 程序结构  
  - 公网服务器：
    - 返回被控机器的IP 和端口号  
    - 记录当前在线的机器`(可选)`  
  - 被控端：  
    - 绑定一个固定端口
    - 定时向公网服务器查询自己的公网IP 和端口号`(维持NAT )`
    - 新建一个线程，利用本地socket 连接自己的公网端口以维持TCP 长连接  
    - 将不是心跳包的端口流量转发至`3389`  
  - 主控端：  
    - 采用`RDP`，连接时`ip:port`  

## 笔记  

- `python` 函数要先定义在使用，除非是在函数中调用，这也是为什么要有`if __name__ == '__main__'` 的原因之一吧。
- `RDP` 协议中间会两次断开连接  
